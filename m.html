<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç®€æ­Œè¯éŸ³ä¹æ’­æ”¾å™¨</title>
    <style>
      :root {
        /* æ—¥é—´æ¨¡å¼å˜é‡ */
        --bg-color: #f5f5f5;
        --text-color: #333;
        --panel-bg: rgba(245, 245, 245, 0.9);
        --progress-bg: rgba(0, 0, 0, 0.1);
        --progress-color: #4a8cff;
        --control-btn-hover: rgba(0, 0, 0, 0.05);
        --playlist-bg: rgba(245, 245, 245, 0.9);
        --playlist-item-hover: rgba(0, 0, 0, 0.05);
        --playlist-active: rgba(74, 140, 255, 0.15);
        --lyrics-bg: rgba(0, 0, 0, 0.03);
        --lyrics-color: #666;
        --lyrics-active: #333;
        --album-art-bg: linear-gradient(135deg, #dedede, #b6b6b6);
        ;
        --timer-color: #777;
      }

      .dark-mode {
        /* å¤œé—´æ¨¡å¼å˜é‡ */
        --bg-color: #121212;
        --text-color: #fff;
        --panel-bg: rgba(18, 18, 18, 0.9);
        --progress-bg: rgba(255, 255, 255, 0.1);
        --progress-color: #4a8cff;
        --control-btn-hover: rgba(255, 255, 255, 0.1);
        --playlist-bg: rgba(20, 20, 20, 0.8);
        --playlist-item-hover: rgba(255, 255, 255, 0.05);
        --playlist-active: rgba(74, 140, 255, 0.15);
        --lyrics-bg: rgba(255, 255, 255, 0.03);
        --lyrics-color: #aaa;
        --lyrics-active: #fff;
        --album-art-bg: linear-gradient(135deg, #803608, #3b0a03);
        --timer-color: #aaa;
      }

      * {
        margin: 0;
        box-sizing: border-box;
      }

      body {
        background: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        transition: background 0.3s ease, color 0.3s ease;
      }

      .player-main {
        flex: 1;
        padding: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        background: var(--panel-bg);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: background 0.3s ease;
      }

      .album-art {
        width: 180px;
        height: 180px;
        margin-bottom: 20px;
        border-radius: 50%;
        overflow: hidden;
        animation: rotate 10s linear infinite;
        animation-play-state: paused;
        position: relative;
        background: var(--album-art-bg);
        transition: background 0.3s ease;
      }

      .album-art.playing {
        animation-play-state: running;
      }

      .album-art::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        background: var(--bg-color);
        border-radius: 50%;
        z-index: 1;
        transition: background 0.3s ease;
      }

      .song-info {
        text-align: center;
        margin-bottom: 20px;
        width: 100%;
      }

      .song-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .progress-area {
        width: 100%;
        margin-bottom: 20px;
      }

      .progress-bar {
        height: 6px;
        width: 100%;
        background: var(--progress-bg);
        border-radius: 3px;
        cursor: pointer;
        margin-bottom: 5px;
        position: relative;
        transition: background 0.3s ease;
      }

      .progress {
        height: 100%;
        width: 0%;
        background: var(--progress-color);
        border-radius: 3px;
        position: relative;
        transition: width 0.1s linear;
      }

      .progress::after {
        content: '';
        position: absolute;
        right: -5px;
        top: 50%;
        transform: translateY(-50%);
        width: 12px;
        height: 12px;
        background: var(--text-color);
        border-radius: 50%;
        opacity: 0;
        transition: opacity 0.2s, background 0.3s ease;
      }

      .progress-bar:hover .progress::after,
      .progress-bar.dragging .progress::after {
        opacity: 1;
      }

      .timer {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: var(--timer-color);
        transition: color 0.3s ease;
      }

      .controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
      }

      .control-btn {
        background: none;
        border: none;
        color: var(--text-color);
        font-size: 18px;
        cursor: pointer;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        transition: all 0.3s;
      }

      .control-btn:hover {
        background: var(--control-btn-hover);
      }

      .play-pause {
        width: 60px;
        height: 60px;
        background: var(--progress-color);
        color: white;
      }

      .play-pause:hover {
        transform: scale(1.05);
      }

      .loop-btn {
        color: var(--timer-color);
        transition: color 0.3s;
      }

      .loop-btn.active {
        color: var(--progress-color);
      }

      .playlist-section {
        width: 400px;
        background: var(--playlist-bg);
        padding: 20px 15px;
        overflow-y: auto;
        border-radius: 15px;
        margin-left: 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transition: background 0.3s ease;
      }

      .playlist-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--progress-bg);
      }

      .playlist {
        height: 432px;
      }

      .playlist::-webkit-scrollbar {
        width: 0;
      }

      .playlist-title {
        font-size: 18px;
        font-weight: 600;
      }

      .playlist-count {
        font-size: 14px;
        color: var(--timer-color);
        transition: color 0.3s ease;
      }

      .playlist-item {
        padding: 12px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
      }

      .playlist-item:hover {
        background: var(--playlist-item-hover);
      }

      .playlist-item.active {
        background: var(--playlist-active);
      }

      .playlist-item .song-details {
        font-size: 14px;
        margin-bottom: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
      }

      .playlist-item .song-details:before {
        content: "ğŸµ ";
        font-family: 'Segoe UI Symbol';
      }

      .playlist-item .duration {
        font-size: 12px;
        color: var(--timer-color);
        transition: color 0.3s ease;
      }

      /* æ­Œè¯åŒºåŸŸæ ·å¼ */
      .lyrics-container {
        width: 100%;
        height: 180px;
        overflow-y: auto;
        text-align: center;
        padding: 10px 0 0;
        border-radius: 8px;
        background: var(--lyrics-bg);
        border-bottom: 10px rgba(0, 0, 0, 0) solid;
        transition: background 0.3s ease;
      }

      .lyrics-container::-webkit-scrollbar {
        width: 0;
      }

      .lyrics-line {
        font-size: 16px;
        line-height: 2;
        color: var(--lyrics-color);
        transition: color 0.3s, font-size 0.3s;
        padding: 2px 0;
      }

      .lyrics-line.active {
        color: var(--lyrics-active);
        font-size: 18px;
        font-weight: 600;
      }

      .lyrics-placeholder {
        color: var(--lyrics-color);
        font-style: italic;
        padding: 20px;
        transition: color 0.3s ease;
      }

      /* éŸ³é‡æ§åˆ¶æ ·å¼ */
      .volume-control {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 10px;
      }

      .volume-btn {
        width: 40px;
        height: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-size: 20px;
      }

      .volume-slider-container {
        width: 80px;
        height: 30px;
        display: flex;
        align-items: center;
      }

      .volume-slider {
        -webkit-appearance: none;
        width: 100%;
        height: 4px;
        border-radius: 2px;
        background: var(--progress-bg);
        outline: none;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--progress-color);
        cursor: pointer;
        transition: background 0.3s;
      }

      .volume-slider::-moz-range-thumb {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--progress-color);
        cursor: pointer;
        border: none;
        transition: background 0.3s;
      }

      /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
      .theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-color);
        transition: color 0.3s ease, transform 0.3s ease;
      }

      .theme-toggle:hover {
        transform: rotate(30deg);
      }

      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }

        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="dark-mode">
    <button class="theme-toggle" style="font-family: 'Segoe UI Symbol'" id="theme-toggle">ğŸŒ™</button>

    <div class="player-main">
      <div class="album-art"></div>

      <div class="song-info">
        <h2 class="song-title">å°±è®©ä¸€åˆ‡éšé£</h2>
      </div>

      <div class="progress-area">
        <div class="progress-bar">
          <div class="progress"></div>
        </div>
        <div class="timer">
          <span class="current-time">0:00</span>
          <span class="max-duration">0:00</span>
        </div>
      </div>

      <div class="controls">
        <button class="control-btn loop-btn" style="font-family: 'Segoe UI Symbol'" title="å¾ªç¯æ’­æ”¾">
          ğŸ”
        </button>
        <button class="control-btn prev-btn" title="ä¸Šä¸€æ›²">
          â®
        </button>
        <button class="control-btn play-pause" title="æ’­æ”¾">
          â–¶
        </button>
        <button class="control-btn next-btn" title="ä¸‹ä¸€æ›²">
          â­
        </button>

        <!-- éŸ³é‡æ§åˆ¶ -->
        <div class="volume-control">
          <button class="control-btn volume-btn" style="font-family: 'Segoe UI Symbol'" title="éŸ³é‡">ğŸ”Š</button>
          <div class="volume-slider-container">
            <input type="range" class="volume-slider" min="0" max="1" step="0.01" value="1">
          </div>
        </div>
      </div>

      <div class="lyrics-container">
        <div class="lyrics-placeholder">æ­Œè¯åŠ è½½ä¸­...</div>
      </div>
    </div>

    <div class="playlist-section">
      <div class="playlist-header">
        <div class="playlist-title">æ’­æ”¾åˆ—è¡¨</div>
        <div class="playlist-count">1é¦–æ­Œæ›²</div>
      </div>

      <div class="playlist">
        <li class="playlist-item active">
          <div class="song-details">
            <div class="song-name">å°±è®©ä¸€åˆ‡éšé£</div>
          </div>
          <div class="duration">4:30</div>
        </li>
      </div>
    </div>

    <audio id="audio-player"></audio>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // è·å–DOMå…ƒç´ 
        const audioPlayer = document.getElementById('audio-player');
        const albumArt = document.querySelector('.album-art');
        const playPauseBtn = document.querySelector('.play-pause');
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');
        const loopBtn = document.querySelector('.loop-btn');
        const progressBar = document.querySelector('.progress-bar');
        const progress = document.querySelector('.progress');
        const currentTimeEl = document.querySelector('.current-time');
        const maxDurationEl = document.querySelector('.max-duration');
        const lyricsContainer = document.querySelector('.lyrics-container');
        const songTitle = document.querySelector('.song-title');
        const playlistEl = document.querySelector('.playlist');
        const playlistCountEl = document.querySelector('.playlist-count');

        // éŸ³é‡æ§åˆ¶å…ƒç´ 
        const volumeBtn = document.querySelector('.volume-btn');
        const volumeSlider = document.querySelector('.volume-slider');

        // ä¸»é¢˜åˆ‡æ¢å…ƒç´ 
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        let lyricsLines;

        let songList = [];
        let currentSongIndex = 0;

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
          const savedTheme = localStorage.getItem('theme');
          if (savedTheme === 'light') {
            body.classList.remove('dark-mode');
            themeToggle.textContent = 'â—ï¸';
          } else {
            body.classList.add('dark-mode');
            themeToggle.textContent = 'ğŸŒ™';
          }
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
          if (body.classList.contains('dark-mode')) {
            body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light');
            themeToggle.textContent = 'â—ï¸';
          } else {
            body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark');
            themeToggle.textContent = 'ğŸŒ™';
          }
        }

        // ä¸»é¢˜åˆ‡æ¢äº‹ä»¶
        themeToggle.addEventListener('click', toggleTheme);

        function formatTime(s) {
          const minutes = Math.floor(s / 60);
          const remainingSeconds = s % 60;
          const formattedMinutes = String(minutes).padStart(2, '0');
          const formattedSeconds = String(remainingSeconds).padStart(2, '0');
          return `${formattedMinutes} : ${formattedSeconds}`;
        }
        // è·å–æ­Œå•æ•°æ®
        fetch("music/songs.json")
          .then(response => {
            if (!response.ok) {
              throw new Error('ç½‘ç»œå“åº”ä¸æ­£å¸¸');
            }
            return response.json();
          })
          .then(songs => {
            songList = songs;
            playlistCountEl.textContent = `${songList.length}é¦–æ­Œæ›²`;

            // æ¸…ç©ºæ’­æ”¾åˆ—è¡¨
            playlistEl.innerHTML = '';

            // ç”Ÿæˆæ’­æ”¾åˆ—è¡¨é¡¹
            songList.forEach((song, index) => {
              const li = document.createElement('li');
              li.className = 'playlist-item';
              if (index === currentSongIndex) {
                li.classList.add('active');
              }

              li.innerHTML = `
                            <div class="song-details">${song.song_name}</div>
                            <div class="duration">${formatTime(song.duration)}</div>
                        `;

              li.addEventListener('click', () => {
                currentSongIndex = index;
                loadSong(currentSongIndex);
                updatePlaylistHighlight();
              });

              playlistEl.appendChild(li);
            });

            // åŠ è½½ç¬¬ä¸€é¦–æ­Œ
            loadSong(currentSongIndex);
          })
          .catch(error => {
            playlistCountEl.textContent = 'è·å–æ­Œå•å¤±è´¥';
          });

        function parseLrc(lrcString) {
          const lines = lrcString.split('\n');
          const lyrics = [];
          for (const line of lines) {
            const match = line.match(/^\[(\d{2}):(\d{2}\.\d+)\](.*)/);
            if (match) {
              const minutes = parseInt(match[1]);
              const seconds = parseFloat(match[2]);
              const time = minutes * 60 + seconds;
              const text = match[3].trim();
              if (text) {
                lyrics.push({
                  time,
                  text
                });
              }
            }
          }
          return lyrics;
        }

        function loadSong(index) {
          const song = songList[index];
          fetch(`music/${song.lrc_file}`)
            .then(response => {
              if (!response.ok) {
                throw new Error('æ­Œè¯åŠ è½½å¤±è´¥');
              }
              return response.text();
            })
            .then(lrcText => {
              const songData = {
                title: song.song_name,
                artist: "",
                src: `music/${song.mp3_file}`,
                lyrics: parseLrc(lrcText)
              };

              initPlayer(songData);
            })
            .catch(error => {
              console.error('åŠ è½½æ­Œè¯å¤±è´¥:', error);
              const songData = {
                title: song.song_name,
                artist: "",
                src: `music/${song.mp3_file}`,
                lyrics: []
              };

              initPlayer(songData);
            });
        }

        function initPlayer(songData) {
          songTitle.textContent = songData.title;
          // è®¾ç½®éŸ³é¢‘æº
          audioPlayer.src = songData.src;
          audioPlayer.load();
          // æ¸²æŸ“æ­Œè¯
          renderLyrics(songData.lyrics);

          // æ›´æ–°æ’­æ”¾åˆ—è¡¨é«˜äº®
          updatePlaylistHighlight();
        }

        // æ›´æ–°æ’­æ”¾åˆ—è¡¨é«˜äº®
        function updatePlaylistHighlight() {
          const items = document.querySelectorAll('.playlist-item');
          items.forEach((item, index) => {
            if (index === currentSongIndex) {
              item.classList.add('active');
            } else {
              item.classList.remove('active');
            }
          });
        }

        // æ¸²æŸ“æ­Œè¯
        function renderLyrics(lyrics) {
          lyricsContainer.innerHTML = '';

          if (lyrics.length === 0) {
            const placeholder = document.createElement('div');
            placeholder.className = 'lyrics-placeholder';
            placeholder.textContent = 'æš‚æ— æ­Œè¯';
            lyricsContainer.appendChild(placeholder);
            return;
          }

          lyrics.forEach(item => {
            const lineEl = document.createElement('div');
            lineEl.className = 'lyrics-line';
            lineEl.setAttribute('data-time', item.time);
            lineEl.textContent = item.text;
            lyricsContainer.appendChild(lineEl);
          });
          lyricsLines = document.querySelectorAll('.lyrics-line');
        }

        // æ›´æ–°æ­Œè¯é«˜äº®
        let lastLine = -1;
        let activeLine = 0;

        function updateLyricsHighlight(currentTime) {
          if (lyricsLines.length === 0) return;

          // æ‰¾åˆ°å½“å‰æ—¶é—´å¯¹åº”çš„æ­Œè¯è¡Œ
          for (let i = 0; i < lyricsLines.length; i++) {
            const lineTime = parseFloat(lyricsLines[i].getAttribute('data-time'));
            if (currentTime >= lineTime) {
              activeLine = i;
            } else {
              break;
            }
          }
          // æ›´æ–°æ­Œè¯è¡ŒçŠ¶æ€
          if (activeLine !== lastLine) {
            lyricsLines.forEach((line, index) => {
              if (index === activeLine) {
                line.classList.add('active');
                // æ»šåŠ¨åˆ°å½“å‰æ­Œè¯è¡Œ
                const lineRect = line.getBoundingClientRect();
                const containerRect = lyricsContainer.getBoundingClientRect();
                const scrollDelta = lineRect.top + lineRect.height / 2 - containerRect.top - containerRect
                  .height / 2;
                lyricsContainer.scrollTo({
                  top: lyricsContainer.scrollTop + scrollDelta,
                  behavior: 'smooth'
                });
              } else {
                line.classList.remove('active');
              }
            });
            lastLine = activeLine;
          }
        }

        // æ’­æ”¾/æš‚åœ
        function togglePlayPause() {
          audioPlayer.setAttribute("autoplay", "");
          if (audioPlayer.paused) {
            audioPlayer.play();
            albumArt.classList.add('playing');
            playPauseBtn.innerHTML = 'â¸';
          } else {
            audioPlayer.pause();
            albumArt.classList.remove('playing');
            playPauseBtn.innerHTML = 'â–¶';
          }
        }

        // ä¸Šä¸€æ›²
        function playPrevious() {
          currentSongIndex = (currentSongIndex - 1 + songList.length) % songList.length;
          loadSong(currentSongIndex);
        }

        // ä¸‹ä¸€æ›²
        function playNext() {
          currentSongIndex = (currentSongIndex + 1) % songList.length;
          loadSong(currentSongIndex);
        }

        // åˆ‡æ¢å¾ªç¯
        function toggleLoop() {
          audioPlayer.loop = !audioPlayer.loop;
          loopBtn.classList.toggle('active', audioPlayer.loop);
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
          const currentTime = audioPlayer.currentTime;
          const duration = audioPlayer.duration || 0;

          // æ›´æ–°è¿›åº¦æ¡
          const progressPercent = duration ? (currentTime / duration) * 100 : 0;
          progress.style.width = `${progressPercent}%`;

          // æ›´æ–°æ—¶é—´æ˜¾ç¤º
          currentTimeEl.textContent = formatTime(currentTime);

          // æ›´æ–°æ­Œè¯é«˜äº®
          updateLyricsHighlight(currentTime);
        }

        // æ›´æ–°æ€»æ—¶é•¿
        function updateDuration() {
          maxDurationEl.textContent = formatTime(audioPlayer.duration || 0);
        }

        // æ­Œæ›²ç»“æŸ
        function onSongEnd() {
          if (audioPlayer.loop) {
            audioPlayer.currentTime = 0;
            audioPlayer.play();
          } else {
            playNext();
          }
        }

        // è¿›åº¦æ¡ç‚¹å‡»è·³è½¬
        function seek(e) {
          const rect = progressBar.getBoundingClientRect();
          const percent = (e.clientX - rect.left) / rect.width;
          audioPlayer.currentTime = percent * audioPlayer.duration;
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
          const min = Math.floor(seconds / 60);
          const sec = Math.floor(seconds % 60);
          return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

        // éŸ³é‡æ§åˆ¶å‡½æ•°
        function setupVolumeControl() {
          // åˆå§‹éŸ³é‡è®¾ç½®
          audioPlayer.volume = volumeSlider.value;

          // éŸ³é‡æ»‘å—äº‹ä»¶
          volumeSlider.addEventListener('input', function() {
            audioPlayer.volume = this.value;
            updateVolumeIcon();
          });

          // éŸ³é‡æŒ‰é’®ç‚¹å‡»äº‹ä»¶ - é™éŸ³/å–æ¶ˆé™éŸ³
          volumeBtn.addEventListener('click', function() {
            if (audioPlayer.volume > 0) {
              // ä¿å­˜å½“å‰éŸ³é‡å¹¶è®¾ç½®ä¸º0
              volumeSlider.dataset.prevVolume = audioPlayer.volume;
              audioPlayer.volume = 0;
              volumeSlider.value = 0;
            } else {
              // æ¢å¤ä¹‹å‰çš„éŸ³é‡
              audioPlayer.volume = volumeSlider.dataset.prevVolume || 0.7;
              volumeSlider.value = audioPlayer.volume;
            }
            updateVolumeIcon();
          });
        }

        // æ›´æ–°éŸ³é‡å›¾æ ‡
        function updateVolumeIcon() {
          if (audioPlayer.volume === 0) {
            volumeBtn.innerHTML = 'ğŸ”‡';
          } else if (audioPlayer.volume < 0.5) {
            volumeBtn.innerHTML = 'ğŸ”ˆ';
          } else {
            volumeBtn.innerHTML = 'ğŸ”Š';
          }
        }

        // äº‹ä»¶ç›‘å¬
        playPauseBtn.addEventListener('click', togglePlayPause);
        prevBtn.addEventListener('click', playPrevious);
        nextBtn.addEventListener('click', playNext);
        loopBtn.addEventListener('click', toggleLoop);
        progressBar.addEventListener('click', seek);

        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('loadedmetadata', updateDuration);
        audioPlayer.addEventListener('ended', onSongEnd);

        // åˆå§‹åŒ–éŸ³é‡æ§åˆ¶
        setupVolumeControl();

        // åˆå§‹åŒ–ä¸»é¢˜
        initTheme();
      });
    </script>
  </body>
</html>